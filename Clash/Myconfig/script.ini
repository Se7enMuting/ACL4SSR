

- SCRIPT,PT,DIRECT
- SCRIPT,QTS-464C,DIRECT
- SCRIPT,DIRECT-Dev,DIRECT
- "SCRIPT,Discord,\U0001F399️ Discord"
- SCRIPT,user-defined01,ℹ️ 自定义1
- SCRIPT,user-defined02,ℹ️ 自定义2

script:
  shortcuts:
    PT: src_port in [51413,51414,51415,23267,23277,51423,60654,33496,33396]
    QTS-464C: "(src_ip == '192.168.1.4' or src_ip == 'fe80::265e:beff:fe82:f950')
      and network == 'udp'"
    Discord: network == 'udp' and dst_port in [50001,50002,50003,50004,50005,50006,50007,50008,50009]
      and dst_ip == '66.22.0.0/16'
    user-defined01: src_ip == '192.168.1.112' or src_ip == 'fe80::7c84:db24:90fe:d69e'
      or src_ip == '2408:820c:8239:3440:a08a:8a06:51a6:ef24' or src_ip == '2408:820c:8239:3440:9a92:23c8:9b07:483e'
    user-defined02: dst_port in [3478] and network == 'udp'
    DIRECT-Dev: dst_port in [3389,3489,3689] and 'link-g.cn' in host
  code: |
    def main(ctx,metadata):
        port = int(metadata['dst_port'])
        if metadata['network'] == 'UDP' and port == 443:
            ctx.log('[Script] matched QUIC traffic use reject')
            return 'REJECT'
        port_list = [21,22,23,53,80,123,143,194,443,465,587,853,993,995,998,2052,2053,2082,2083,2086,2095,2096,3389,5222,5228,5229,5230,8080,8443,8880,8888,8889]
        if port not in port_list:
            ctx.log('[Script] not common port use direct')
            return 'DIRECT'
        if metadata['dst_ip'] == '':
            metadata['dst_ip'] = ctx.resolve_ip(metadata['host'])
        if metadata['dst_ip'] != '':
            code = ctx.geoip(metadata['dst_ip'])
            if code == 'CN':
                ctx.log('[Script] Geoip CN')
                return '🎯 大陆直连'
        ctx.log('[Script] FINAL')
        return '🐟 漏网之鱼'
